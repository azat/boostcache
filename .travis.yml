language: cpp

compiler:
    # Waiting for next issues:
    #   travis-ci/travis-cookbooks#114
    #   travis-ci/travis-core#195
    # - gcc
    - clang

before_script:
    - sudo add-apt-repository -y ppa:azat/boost-unofficial
    - sudo apt-get update
    - sudo apt-get install libboost1.53-all-dev
    - sudo apt-get install gawk
    # Version of some utils
    - bash --version
    - awk --version
    - gawk --version
    - sed --version

script:
    - mkdir .cmake
    - cd .cmake
    - cmake ..
    - make
    # Run one_connection, with 1 worker
    # We have one connection, so we don't need in more than 1 worker.
    - ./boostcached -f -w1
    - sleep 2
    - ../utils/one_conn_awk_bench.sh
    # TODO: try to use $!
    - pkill -u $USER boostcached
    # Run bc-benchmark, with 3 workers
    # We have multiple connections, this must speedup server
    - ./boostcached -f -w3
    - sleep 2
    - ../src/benchmark/bc-benchmark
    # TODO: add gtest

branches:
    only:
        - master

# TODO: add notifications
